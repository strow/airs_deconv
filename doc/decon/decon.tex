\documentclass[12pt]{article}
\usepackage{graphicx}
\usepackage{placeins}

\input{crisdefs.tex}

\title{FIRST DRAFT \\
  \vspace{5mm}
  Deconvolution and Translation \\
  Between High Spectral Resolution  \\
  IR Sounders \\
}

\author{Howard E.~Motteler \\
  \\
  UMBC Atmospheric Spectroscopy Lab \\
  Joint Center for Earth Systems Technology \\
}

\date{\today}
\begin{document}

\maketitle

\section{Introduction}

Upwelling infrared radiation as measured by the {\airs}, {\iasi},
and {\cris} sounders is a significant part of the long term climate
record.  We would like to treat this information as a single data
set but the instruments have different spectral resolutions, channel
response functions, and band spans.  As a first step in addressing
this problem we consider several channel radiance translations:
{\iasi} to high resolution {\cris}, {\iasi} to {\airs}, {\airs} to
standard resolution {\cris}, and high resolution {\cris} to {\airs}.

Translation from {\airs} to {\cris} presents a special challenge
because {\cris} and {\iasi} are Michaelson interferometers with
parametrized response functions, while {\airs} is a grating
spectrometer with channel center frequencies and spectral response
functions determined by the focal plane geometery.  In section
\ref{decon} we show how to take advantage of detailed knowledge of
the {\airs} spectral response function (SRF) shapes to deconvolve
{\airs} channel radiances to a resolution enhanced intermediate
representation.

The translations presented here are validated by comparisons with
calculated reference truth.  For example to test the {\iasi} to
{\airs} translation, we start with 49 fitting profiles spanning a
significant range of atmospheric conditions.  Upwelling radiance is
calculated at a 0.0025 {\wn} grid with kcarta over a band spanning
the {\airs} and {\iasi} response functions.  ``True {\airs}'' is
calculated from this by convolving the kcarta radiances with
tabulated {\airs} SRFs, and ``true {\iasi}'' by convolving kcarta
radiances to the {\iasi} instrument specs.  {\iasi} is translated to
{\airs} (we call this ``{\iasi} {\airs}'') and this is compared with
true {\airs}.

This sort of validation assumes perfect knowledge of the {\airs} 
and {\iasi} instrument response functions and so gives only a lower
bound on how well the translations can work in practice.  But the
better we know the response functions, the closer practical
translations can approach these limits.

The conversions here are presented in order of their residuals, with
{\iasi} to high resolution {\cris} most accurate and high resolution
{\cris} to {\airs} the least.


\section{IASI to high resolution CrIS}

The {\cris} user grid comprises three bands, LW 650 to 1095 {\wn},
MW 1210 to 1750 {\wn}, and SW 2155 to 2550 {\wn}.  For the {\cris}
high resolution mode the channel spacing is 0.625 {\wn} for all
three bands.  The {\cris} user ILS is a sinc function.  The {\iasi}
user grid is a single band from 645 to 2760 {\wn} with a channel
spacing of 0.5 {\wn}.  The {\iasi} user ILS is a sinc function
convolved with the modified Gaussian, shown in figure \ref{igauss}.

{\iasi} to {\cris} is a relatively easy translation because {\iasi}
spans the {\cris} bands and has a nominal (though strongly apodized)
higher resolution.  The main steps of the translation, for each
{\cris} band, are

\begin{itemize}

  \item apply a bandpass filter to the {\iasi} channel radiances to
    restrict them to a single {\cris} band with a roughly 20 {\wn}
    rolloff outside the {\cris} user grid.  For the LW band we use
    a 5 {\wn} rolloff because {\iasi} starts at 645 {\wn}.

  \item take the filtered radiances to an interferogram with an
    inverse Fourier transform

  \item apply the pointwise inverse of the {\iasi} Gaussian over the 
    {\iasi} 1~cm {\opd} and truncate this to the 0.8~cm {\cris} {\opd}.

  \item take the interferogram back to radiance at the {\cris}
    0.625 {\wn} channel spacing with a forward Fourier transform

\end{itemize}

Figure \ref{iclw1} shows the mean and standard deviation of {\iasi}
{\cris} minus true {\cris} over the 49 fitting profiles, for the
{\cris} LW band.  The residual is greatest at the low end of the LW
band.  This may be due in part to the 5 {\wn} LW rolloff, as
residuals near the band edges are larger with a smaller rolloff.
The residual is reduced significantly if we apply Hamming
apodization to the {\iasi} {\cris} and true {\cris} radiances, as
shown in figure \ref{iclw2}.  Figures \ref{icmw1} and \ref{icsw1}
show similar results for the unapodized radiances for the MW and SW
bands. The residuals are very small.  Unless otherwise noted, all
{\cris} spectra shown here are unapodized.

% \newpage

\begin{figure}
  \centering
  \includegraphics[height=8cm]{figures/iasi_gauss_app.pdf}
  \caption{{\iasi} truncated Gaussian apodization}
  \label{igauss}
\end{figure}

\begin{figure}
  \centering
  \includegraphics[height=8cm]{figures/iasi_cris_lw_1.pdf}
  \caption{Mean and standard deviation of unapodized {\iasi} {\cris}
    minus true {\cris}, for the {\cris} LW band.}
  \label{iclw1}
\end{figure}

\begin{figure}
  \centering
  \includegraphics[height=8cm]{figures/iasi_cris_lw_2.pdf}
  \caption{Mean and standard deviation of Hamming apodized {\iasi}
    {\cris} minus true {\cris}, for the {\cris} LW band.}
% The residual is reduced by an order of magnitude
  \label{iclw2}
\end{figure}

\begin{figure}
  \centering
  \includegraphics[height=8cm]{figures/iasi_cris_mw_1.pdf}
  \caption{Mean and standard deviation of unapodized {\iasi} {\cris}
    minus true {\cris}, for the {\cris} MW band.}
  \label{icmw1}
\end{figure}

\begin{figure}
  \centering
  \includegraphics[height=8cm]{figures/iasi_cris_sw_1.pdf}
  \caption{Mean and standard deviation of unapodized {\iasi} {\cris}
    minus true {\cris}, for the {\cris} SW band.}
  \label{icsw1}
\end{figure}

\FloatBarrier


\section{IASI to AIRS}

{\airs} L1b radiances are a set of channels between approximately
650 to 2650 {\wn} with the individual center frequencies and
spectral response functions (SRFs) determined by the focal plane
geometery.  Channels are not uniformly spaced.  {\airs} L1c
radiances are derived from the L1b with improvements including a
more uniform spacing.  The {\iasi} to {\airs} translation works for
either channel set and is done as follows

% The {\iasi} to {\airs} translation applies a deconvolution to the
% full {\iasi} band, to a 0.1 {\wn} intermediate grid, and then an
% {\airs} convolution to get {\airs} channel radiances.  

\begin{itemize}

  \item apply a bandpass filter to the {\iasi} radiances to restrict
    them to the {\airs} band span, with a 5 {\wn} rolloff

  \item deconvolve the filtered {\iasi} radiances to a 0.1 {\wn}
    intermediate grid, the nominal resolution of the {\airs} SRF
    tabulation.  Aside from resolution and band spans, this exactly
    the same transform used for the {\iasi} to {\cris} translation
    and is done with the same procedure, iasi\_decon.m

  \item convolve the 0.1 {\wn} intermediate representation with either
    the {\airs} L1b or L1c SRFs.  Section \ref{decon} discusses this
    convolution in greater detail.
    
\end{itemize}

Figure \ref{srfs1} shows the first three {\airs} SRFs and the
bandpass filter wing.  Note the relatively gentle slope of the
rolloff, to decrease impulse ringing.  The first two {\airs} SRFs
are ``guard channels'' and the third the first regular channel.  
The wings of the SRFs roll off well inside the bandpass filter.

Figure \ref{iaspec} shows true {\iasi}, true {\airs}, deconvolved
{\iasi}, and {\iasi} {\airs}.  At this level of detail we mainly see
the greater fine structure in the deconvolution.  Figure \ref{iaszoom}
shows details from 660 to 680 {\wn}.  Figure \ref{iadiff} shows
{\iasi} {\airs} minus true {\airs}.  The residual is larger than for
the {\iasi} to {\cris} translation, but significantly better than
the {\airs} to {\cris} or {\cris} to {\airs} translations.

\begin{figure}
  \centering
  \includegraphics[height=8cm]{figures/srfs_and_filt.png}
  \caption{The first three {\airs} SRFs and the bandpass filter
    wing}
  \label{srfs1}
\end{figure}

\begin{figure}
  \centering
  \includegraphics[height=8cm]{figures/iasi_airs_spec.pdf}
  \caption{true {\iasi}, true {\airs}, deconvolved {\iasi}, and
    {\iasi} {\airs} }
  \label{iaspec}
\end{figure}

\begin{figure}
  \centering
  \includegraphics[height=8cm]{figures/iasi_airs_zoom.pdf}
  \caption{true {\iasi}, true {\airs}, deconvolved {\iasi}, and
    {\iasi} {\airs}, detail }
  \label{iazoom}
\end{figure}

\begin{figure}
  \centering
  \includegraphics[height=8cm]{figures/iasi_airs_diff.pdf}
  \caption{Mean and standard deviation of {\iasi} {\airs} minus true
    {\airs} }
  \label{iadiff}
\end{figure}

\FloatBarrier

\section{AIRS to standard resolution CrIS}

For the {\cris} standard resolution mode the channel spacing is
0.625 {\wn} for the LW, 1.25 {\wn} for the MW, and 2.5 {\wn} for the
SW bands.  The {\iasi} deconvolution was a key step in the {\iasi}
to {\cris} and {\iasi} to {\airs} translations.  Similarly, {\airs}
deconvolution is central to the {\airs} to {\cris} translation and
is presented in detail in section \ref{decon}.  The first step in
the {\airs} L1c to {\cris} translation is to deconvolve the {\airs}
L1c channel radiances to a 0.1 {\wn} intermediate grid, the nominal
{\airs} SRF resolution.  Then for each {\cris} band,

\begin{itemize}
  \item find the {\airs} and {\cris} band intersection

  \item apply a bandpass filter to the deconvolved {\airs} radiances
    to restrict them to the intersection, rolling off the wings when
    the AIRS band and gaps allow for this

  \item reconvolve the filtered spectra to the user grid channel
    spacing for the current {\cris} band

  \item trim the reconvolved spectra to the band intersection 
\end{itemize}

Figure \ref{aclws} shows true {\cris}, true {\airs}, deconvolved
{\airs}, and {\airs} {\cris}.  At this level of detail we mainly see
the greater fine structure in the deconvolution.  Figure \ref{aclwz}
shows details from 660 to 680 {\wn}.  In comparison with the {\iasi}
deconvolution in figure \ref{iazoom} the {\airs} deconvolution is
not as smooth.  The remaining figures show true {\cris} minus
{\airs} {\cris} for the 49 fitting profiles, with and without
Hamming apodization for each of the {\cris} bands.  The residuals
are significantly reduced with apodization but are larger than for
the {\iasi} to {\cris} translation.

\begin{figure}
  \centering
  \includegraphics[height=8cm]{figures/airs_cris_spec_LW_noap.pdf}
  \caption{true {\cris}, true {\airs}, deconvolved {\airs}, and
    {\airs} {\cris} }
  \label{aclws}
\end{figure}

\begin{figure}
  \centering
  \includegraphics[height=8cm]{figures/airs_cris_zoom_LW_noap.pdf}
  \caption{true {\cris}, true {\airs}, deconvolved {\airs}, and
    {\airs} {\cris}, detail }
  \label{aclwz}
\end{figure}

% \begin{figure}
%   \centering
%   \includegraphics[height=8cm]{figures/airs_cris_spec_MW_noap.pdf}
%   \caption{ }
%   \label{acmws}
% \end{figure}

% \begin{figure}
%   \centering
%   \includegraphics[height=8cm]{figures/airs_cris_spec_SW_noap.pdf}
%   \caption{ }
%   \label{acsws}
% \end{figure}

\begin{figure}
  \centering
  \includegraphics[height=8cm]{figures/airs_cris_diff_LW_noap.pdf}
  \caption{Mean and standard deviation of unapodized {\airs} {\cris}
    minus true {\cris}, for the {\cris} LW band }
  \label{aclwd}
\end{figure}

\begin{figure}
  \centering
  \includegraphics[height=8cm]{figures/airs_cris_diff_LW_hamm.pdf}
  \caption{Mean and standard deviation of Hamming apodized {\airs}
      {\cris} minus true {\cris}, for the {\cris} LW band }
  \label{aclwdh}
\end{figure}

\begin{figure}
  \centering
  \includegraphics[height=8cm]{figures/airs_cris_diff_MW_noap.pdf}
  \caption{Mean and standard deviation of unapodized {\airs} {\cris}
    minus true {\cris}, for the {\cris} MW band }
  \label{acmwd}
\end{figure}

\begin{figure}
  \centering
  \includegraphics[height=8cm]{figures/airs_cris_diff_MW_hamm.pdf}
  \caption{Mean and standard deviation of Hamming apodized {\airs}
      {\cris} minus true {\cris}, for the {\cris} MW band }
  \label{acmwdh}
\end{figure}

\begin{figure}
  \centering
  \includegraphics[height=8cm]{figures/airs_cris_diff_SW_noap.pdf}
  \caption{Mean and standard deviation of unapodized {\airs} {\cris}
    minus true {\cris}, for the {\cris} SW band }
  \label{acswd}
\end{figure}

\begin{figure}
  \centering
  \includegraphics[height=8cm]{figures/airs_cris_diff_SW_hamm.pdf}
  \caption{Mean and standard deviation of Hamming apodized {\airs}
      {\cris} minus true {\cris}, for the {\cris} SW band }
  \label{acswdh}
\end{figure}

\FloatBarrier

\section{High resolution CrIS to AIRS}

The {\cris} to {\airs} translation differs in that we construct the
intermediate representation at the 0.1 {\wn} {\airs} SRF resolution
by double Fourier interpolation without deconvolution.  For each
{\cris} band, the steps in the translation are as follows

\begin{itemize}
  \item find the {\airs} and {\cris} band intersection

  \item interpolate the {\cris} channel radiances to the intermediate
    grid 

   \item convolve the 0.1 {\wn} intermediate representation with either
    the {\airs} L1b or L1c SRFs
 
\end{itemize}

Note that there is no bandpass filtering used in this translation.
For example in the LW we simply interpolate the full span of the
{\cris} user grid (plus any guard channels) to the intermediate
representation.  Adding a rolloff inside the user grid would improve
residuals near the band edges but would mean dropping channels from
the translation.

Figure \ref{caspec} shows true {\cris}, true {\airs}, interpolated
{\cris}, and {\cris} {\airs}.  Figure \ref{cazoom} shows details
from 660 to 680 {\wn}.  We do not see the resolution enhancement in
the intermediate representation that we got with the {\iasi} and
{\airs} deconvolutions.  Figure \ref{cadiff} shows {\cris} {\airs}
minus true {\airs}.  The residual is quite large in comparison with
the other translations.

\begin{figure}
  \centering
  \includegraphics[height=8cm]{figures/cris_airs_spec.pdf}
  \caption{true {\cris}, true {\airs}, interpolated {\cris}, and
    {\cris} {\airs} }
  \label{caspec}
\end{figure}

\begin{figure}
  \centering
  \includegraphics[height=8cm]{figures/cris_airs_zoom.pdf}
  \caption{true {\cris}, true {\airs}, interpolated {\cris}, and
    {\cris} {\airs}, detail}
  \label{cazoom}
\end{figure}

\begin{figure}
  \centering
  \includegraphics[height=8cm]{figures/cris_airs_diff.pdf}
  \caption{Mean and standard deviation of {\cris} {\airs} minus true
    {\airs}}
  \label{cadiff}
\end{figure}

\FloatBarrier

\section{AIRS Deconvolution}
\label{decon}

\end{document}
